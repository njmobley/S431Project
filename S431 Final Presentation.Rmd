---
title: "Models to Determine Relationship of Motor Skills on Social Deficit"
author: "Alli, Nick, Thomas"
date: "12/4/2019"
output: 
  slidy_presentation
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r,echo = FALSE,include=FALSE}
library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(gridExtra)
library(ggthemes)
library(reportr)
library(knitr)
library(splines)
library(ggpubr)
```

```{r, echo=FALSE,include=FALSE}
kki.demo <- read.csv("Data/KKI_demographicInfo.csv")
kki.social <- read.csv("Data/KKI_SocialResponsivenessScaleQuestionnaire.csv")
kki.movement <- read.csv("Data/KKI_movementAssessmentBatteryforChildren.csv")
kki.hand <- read.csv("Data/KKI_handedness.csv")
wisc <- read.csv("Data/KKI_WechslerIntelligenceScaleforChildren.csv")
wisc4GAI <- read.csv("Data/wisc4GAI_lookup.csv")
wisc5GAI <- read.csv("Data/wisc5GAI_lookup.csv")
colnames(kki.demo)[1] <- "ID"
colnames(kki.social)[1] <- "ID"
colnames(kki.movement)[1] <- "ID"
colnames(kki.hand)[1] <- "ID"
colnames(wisc)[1] <- "ID"
colnames(wisc4GAI)[1] <- "ID"
colnames(wisc5GAI)[1] <- "ID"
wisc4 <- filter(wisc, WISC_VERSION == 4)
wisc5 <- filter(wisc, WISC_VERSION == 5)
wisc4 <- wisc4[-c(11:15)]
wisc5 <- wisc5[-c(5:10)]
wisc4 <- filter(wisc4, visit == 1)
wisc5 <- filter(wisc5, visit == 1)
#Calculate composite scores for both WISC versions
wisc4$score <- rowSums(wisc4[,5:10])
wisc5$score <- rowSums(wisc5[,5:9])
#Filter out NA scores
wisc4 <- na.omit(wisc4, cols = "score")
wisc5 <- na.omit(wisc5, cols = "score")
#Convert composite scores to GAI scores for WISC version 4
composite4 = rep(0,length(wisc4[,1]))
for (i in 1:length(wisc4[,1])) {
  composite4[i] <- wisc4GAI[wisc4[i,11]-5,2]
}
wisc4$GAI <- composite4
#Convert composite scores to GAI scores for WISC version 5
composite5 = rep(0,length(wisc5[,1]))
for (i in 1:length(wisc5[,1])) {
  composite5[i] <- wisc5GAI[wisc5[i,10]-4,2]
}
wisc5$GAI <- composite5
#Remove composite scores
wisc4 <- wisc4[-c(2:11)]
wisc5 <- wisc5[-c(2:10)]
#Combine WISC data
wisc.combo <- full_join(wisc4, wisc5, by = c('ID', 'GAI'))
```

```{r,echo=FALSE,include=FALSE}
kki <- merge(kki.demo,kki.social)
kki <- merge(kki,kki.movement)
kki <- merge(kki,wisc.combo)
kki <- merge(kki,kki.hand)
## Making standard Scores
kki.V1 <- subset(kki,kki$SRS_VERSION == 1)
kki.V2 <- subset(kki,kki$SRS_VERSION == 2)

Two_to_One <- function(from,target) {
  y.bar = mean(target);y.sd = sd(target);
  x.bar = mean(from);x.sd = sd(from);
  right.half = (y.bar - (y.sd/x.sd) * x.bar)
  left.half = y.sd/x.sd
  return (left.half * from + right.half)
}
kki.V1$Standard <- kki.V1$SRS_TotalRawScore
kki.V2$Standard <- Two_to_One(kki.V2$SRS_TotalRawScore,kki.V1$SRS_TotalRawScore)
kki <- rbind(kki.V1,kki.V2)
kki$sqrt.Standard <- sqrt(kki$Standard)
## 555
#Now have all the data in a huge data frame
#Removing N/A values. Mostly removing second visits.
kki <- subset(kki,!is.na(kki$SRS_TotalRawScore))
kki <- subset(kki, !is.na(kki$mABC_TotalStandardScore))
kki <- subset(kki,kki$mABC_AGE<14)
kki2 <- filter(kki,PrimaryDiagnosis != "None",SecondaryDiagnosis ==c("Yes", "No"))
multdia <- filter(kki, PrimaryDiagnosis != "None", SecondaryDiagnosis =="Yes")
singdia <- filter(kki, PrimaryDiagnosis != "None" , SecondaryDiagnosis == "No")
nodia <- filter(kki, PrimaryDiagnosis =="None" , SecondaryDiagnosis =="No")
kki.adhd <- subset(kki,PrimaryDiagnosis == "ADHD")
kki.adhd <- subset(kki.adhd,ADHD_Subtype != "Hyperactive/Impulsive")
kki.adhd1 <- subset(kki.adhd,kki.adhd$SRS_VERSION == 1)
kki.adhd2 <- subset(kki.adhd, kki.adhd$SRS_VERSION == 2)
```


## Introduction: Study Details & Relevant Background Information

- Autism (ASD) and Attention Deficit/Hyperactivity Disorder (ADHD) are frequently observed in children, but are still not fully understood. 

- Researchers at Kennedy Krieger Institute(KKI)  ran a study on children with ASD, ADHD, and typically developing children to study differences in social deficits, motor impairment, intelligence.
    - It is known that children with developmental disorders suffer from motor impairment concurrent with social deficits       associated with their respective diagnoses(1,2).  The extent and cause of this correlation merits further research.

- Metrics and Scales Used to Quantify Symptom Severity in Children:
    1. Social Responsiveness Scale Questionnaire (SRS): measures severity of social deficits in children (higher scores indicate more social deficits)
    2. Movement Assessment Battery for Children (mABC): measures motor impairments in children.  Three subcategories for assessment include dexterity, aiming and catching, and balance summed to obtain the mABC Total Standard Score
    3. Wechsler Intelligence Scale for Children (WISC): measures intelligence in children.  Two versions of the test quantify vocabulary, information, picture concepts, etc. 

## Introduction: Areas of Particular Interest
### Data and Analysis

- We want to investigate the overall association between social deficits and motor skills for each diagnosis group.


    <large>> Primary Endpoint: What motor skills are associated with SRS scores for each diagnosis group.</large>
  
    <large>> Secondary Endpoint: What factors influence this association?</large>
    
- Data Collected for Investigation and Analysis:
    - Age
    - Handedness (quantified by Edinburgh Handedness Integer)
    - Gender
    - Primary and Secondary Diagnosis
    - SRS Total
    - mABC Total and Subscores
    - WISC Score

## Methods: Cleaning Data

```{r,include = FALSE,echo = FALSE}
kki.asd <- subset(kki,kki$PrimaryDiagnosis == 'Autism')
kki.adhd <- subset(kki,kki$PrimaryDiagnosis == 'ADHD')
kki.td <- subset(kki,kki$PrimaryDiagnosis == 'None')
diagnosis <- c("ASD","ADHD","TD")
counts <- c(nrow(kki.asd),nrow(kki.adhd),nrow(kki.td))
age <- c(mean(kki.asd$mABC_AGE),mean(kki.adhd$mABC_AGE),mean(kki.td$mABC_AGE))
kki.asd.male <- subset(kki.asd,kki.asd$Gender == 'M')
kki.asd.female <- subset(kki.asd,kki.asd$Gender == 'F')
kki.adhd.male <- subset(kki.adhd,kki.adhd$Gender == 'M')
kki.adhd.female <- subset(kki.adhd,kki.adhd$Gender == 'F')
kki.td.male <- subset(kki.td, kki.td$Gender == 'M')
kki.td.female <- subset(kki.td,kki.td$Gender == 'F')
maleCount <- c(nrow(kki.asd.male),nrow(kki.adhd.male),nrow(kki.td.male))
femaleCount <- c(nrow(kki.asd.female),nrow(kki.adhd.female),nrow(kki.td.female))
rightCount <- c(124,285,307)
leftCount <- c(20,36,42)
table1 <- cbind(diagnosis,counts,round(age,4),maleCount,femaleCount,rightCount,leftCount)
FinalTable <- kable(table1,col.names = c("Primary","Count","Avg Age","Males","Females","RightHanded","LeftHanded"))
agehist <-ggplot(data = na.omit(kki),aes(group = PrimaryDiagnosis, y = mABC_AGE, colour = PrimaryDiagnosis)) + geom_boxplot()+ coord_flip()+ylab("Age (Years)")+theme_classic() 
```

- Removed Subjects that were under 14, since 94% subjects diagnosed with Autism or ADHD were under 14. Reduced total observations from 832 to 755

```{r, fig.height=2, fig.width=5, fig.align="center"}
agehist
```

- Then Removed Observations that had N/A values for either SRS_TotalRawScore or mABC_TotalStandardScore which furthur reduced the total observations to 568 Observations
- Converted all the WISC scores to the GAI scale for comparability across versions

```{r}
FinalTable
```




## Methods: Exploring Motor Skill's Association with Social Deficits


```{r,echo = FALSE}
graph.dat <- subset(kki,kki$mABC_TotalStandardScore <12)
total <- ggplot(data = graph.dat, aes(x = mABC_TotalStandardScore, y = Standard,colour = PrimaryDiagnosis)) + geom_point(alpha = .3) + geom_jitter() + geom_smooth()+ylab("SRS Total Score")+xlab("Motor Assessment Score")+ggtitle("Overall Motor Ability and Social Deficits")+ theme(legend.position = 'none')
```

```{r,echo = FALSE,include=FALSE}
SRS.Manual <- ggplot(data = kki, aes(x = mABC_ManualDexterity.Component.StandardScore, y = Standard, colour = PrimaryDiagnosis)) + geom_point(alpha = .3) + geom_jitter() + geom_smooth()+ theme(legend.position = 'none')+ylab("SRS Total Score")+xlab("Manual Dexterity Score")+ggtitle("Manual Dexterity and Social Deficits")
```

```{r,echo = FALSE,include=FALSE}
SRS.AimAndCatch <- ggplot(data = kki, aes(x = mABC_AimingAndCatching.Component.StandardScore, y = Standard, colour = PrimaryDiagnosis)) + geom_point(alpha = .3) + geom_jitter() + geom_smooth()+ theme(legend.position = 'none')+ylab("SRS Total Score")+xlab("Aiming and Catching Score")+ggtitle("Aiming & Catching and Social Deficits")
```

```{r,echo = FALSE,include=FALSE}
#Really interesting! 
#The better the ADHD kids were at balance the better their social deficit was! Let's investigate the relationship between age and balance
graph.dat <- subset(kki, kki$mABC_Balance.Component.StandardScore < 15)
SRS.Balance <- ggplot(data = graph.dat, aes(x = mABC_Balance.Component.StandardScore, y = Standard, colour = PrimaryDiagnosis)) + geom_point(alpha = .3) + geom_jitter() + geom_smooth() + theme(legend.position = 'none')+ylab("SRS Total Score")+xlab("Balance Score")+ggtitle("Balance and Social Deficits")
```

```{r,echo = FALSE, fig.height=5, fig.align="center", fig.width=8}
ggarrange(SRS.Manual, SRS.AimAndCatch, SRS.Balance, total, common.legend = TRUE, legend="bottom")
```

- Key Takeaways: The association between motor skills and social deficits is different for each of 
the subcomponents of the mABC, and differ for children with different primary diagnoses.



 
## Methods: Other Variables

```{r, include=FALSE}
gaisrs1 <-ggplot(data = kki, aes(x = GAI, y = Standard,colour = PrimaryDiagnosis)) + geom_point() + geom_smooth() + ylab("SRS Total Score")+xlab("GAI Test Score")+ggtitle("GAI Score and Social Deficits")+ theme(legend.position="none")
gaisrs2 <-ggplot(data = kki, aes(x = GAI, y = mABC_TotalStandardScore,colour = PrimaryDiagnosis)) + geom_point() + geom_jitter() + geom_smooth() + ylab("Total Motor Score")+xlab("GAI Test Score")+ggtitle("GAI Score and Motor Skills")+ theme(legend.position="none")

```


```{r, fig.height=4, fig.width=5, include=FALSE}
ggarrange(gaisrs1, gaisrs2, nrow=1, common.legend = TRUE, legend="bottom")
```

 

```{r, include=FALSE}
kki$Hand <- cut(kki$EdinburghHandedness_Integer,c(-1.01,-.5,.5,1.01),labels = c("Left","Mixed","Right"))
hand1 <- ggplot(data = na.omit(kki),aes(group = Hand,y = mABC_TotalStandardScore, colour = Hand)) + geom_boxplot() + facet_wrap(na.omit(kki)$PrimaryDiagnosis)+ theme(legend.position="none")
hand2 <-ggplot(data = na.omit(kki),aes(group = Hand,y = Standard, colour = Hand)) + geom_boxplot() + facet_wrap(na.omit(kki)$PrimaryDiagnosis)+ theme(legend.position="none")
```

```{r, fig.height=4, fig.width=15, fig.align="left"}
ggarrange(gaisrs1, gaisrs2, hand1, hand2, nrow=1,common.legend = TRUE, legend="bottom")
```

- Key Takeaways: 

  > There seems to be a negative correlation between intelligence and motor skills, but no correlation between intelligence and social deficit.
  
  > Something is going on with Mixed-handedness(?) <- Nick, approve this

## Proposed Models

$$
\text{E[Social Deficit Score]} = \textbf{X} * \boldsymbol{\beta} \\
where: \\
\boldsymbol{\beta} = \begin{bmatrix}
            \text{Intercept} \\
            \text{Balance Score} \\
            \text{Aiming And Catching Score} \\
            \text{EdinburgHandedness_Integer} \\
            \text{GAI} \\
            \text{Gender Male} \\
            \text{mABC_AGE} 
            \end{bmatrix}
$$

```{r,include=FALSE}
kki.1 <- subset(kki,kki$SRS_VERSION == 1)
kki.2 <- subset(kki,kki$SRS_VERSION == 2)
t.test(kki.1$SRS_TotalRawScore,kki.2$SRS_TotalRawScore)
```

- seperate SRS Versions from Welch t-test

$$
H_0: \text{Mean of SRS Total Scores from Version 1 = Mean of SRS Total Scores from Version 2} \\
H_1: \text{Mean of SRS Total Scores from Version 1} \space \neq \text{Mean of SRS Total Scores from Version 2} \\
\text{Under the null we got a t-statistc of -6.03 from a t-distribution of 417.38 Degrees of Freedom} \\
\text{that has a p-value of} \space 3.511 \times 10^{-9} \\ \space \text{Under} \space \alpha = .05 \space \text{we reject the null}
\text{ and believe that there is a true difference in the mean}
$$

## Resutls: Typically Developing

```{r}
nodia1 <- subset(nodia,nodia$SRS_VERSION == 1)
nodia2 <- subset(nodia,nodia$SRS_VERSION == 2)
lm.nodia1 <- lm(SRS_TotalRawScore ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore + EdinburghHandedness_Integer + GAI  + Gender + mABC_AGE, data = nodia1)
lm.nodia2 <- lm(SRS_TotalRawScore ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore + EdinburghHandedness_Integer + GAI  + Gender + mABC_AGE, data = nodia2)
```


$$
\text{E[Social Deficit Score]} = \textbf{X} * \boldsymbol{\beta} \\
where: \\
\boldsymbol{\beta} = \begin{bmatrix}
            \text{Intercept} \\
            \text{Balance Score} \\
            \text{Aiming And Catching Score} \\
            \text{EdinburgHandedness_Integer} \\
            \text{GAI} \\
            \text{Gender Male} \\
            \text{mABC_AGE} 
            \end{bmatrix}
=
\begin{bmatrix}
43.52523 \\
-0.14406 \\
0.01693  \\
-1.46571  \\
0.05956   \\
-1.12175  \\
-0.09471
\end{bmatrix}
$$


$$
P-Value=0.3062
$$
$$
Adjusted R-Squared:  0.01153
$$





## Results: ADHD

```{r,echo=FALSE,include=FALSE}
lm.adhd <- lm(sqrt.Standard ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore + EdinburghHandedness_Integer + GAI + ADHD_Subtype + Gender + mABC_AGE, data = kki.adhd)
lm.basic <- lm(Standard ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore + mABC_ManualDexterity.Component.StandardScore, data = kki.adhd)
lm.maybe <- lm(Standard ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore,data = kki.adhd)
```

$$
\boldsymbol{\beta} = \begin{bmatrix}
            \text{Intercept} \\
            \text{Balance Score} \\
            \text{Aiming And Catching Score} \\
            \text{EdinburgHandedness_Integer} \\
            \text{GAI} \\
            \text{ADHD Subtype Inattentive} \\
            \text{Gender Male} \\
            \text{mABC_AGE} 
\end{bmatrix}
=
\begin{bmatrix}
7.24 \\
-0.0408 \\
-0.0646  \\
0.3292  \\
0.0085   \\
-1.266 \\
-0.175 \\
-0.049 
\end{bmatrix}
$$

```{r,include = FALSE,echo = FALSE}
ggplot(data = kki.adhd,aes(x = mABC_Balance.Component.StandardScore,y = fitted(lm.adhd), colour = ADHD_Subtype)) + geom_point() + geom_jitter() +
  geom_line(data = kki.adhd,aes(x = mABC_Balance.Component.StandardScore, y = mABC_Balance.Component.StandardScore *-2.38729 + 64.0176),colour = 'red',size = 1.5) + 
  geom_line(data = kki.adhd,aes(x = mABC_Balance.Component.StandardScore, y = mABC_Balance.Component.StandardScore *-2.38729 + 50.0456),colour = 'blue',size = 1.5) +     ggtitle("Effect of Balance Component on Total SRS Score") + ylab("Fitted Values") + xlab("mABC Balance Score") + facet_wrap(~Gender)
```

```{r}
males <- which(kki.adhd1$Gender == "M")
ggplot(data = kki.adhd[males,],aes(x = mABC_Balance.Component.StandardScore,y = fitted(lm.adhd)[males], colour = ADHD_Subtype)) + geom_point() + geom_jitter() +
  geom_line(data = kki.adhd[males,],aes(x = mABC_Balance.Component.StandardScore, mABC_Balance.Component.StandardScore *-2.38729 + 64.0176),colour = 'red',size = 1.5) + 
  geom_line(data = kki.adhd1[males,],aes(x = mABC_Balance.Component.StandardScore, mABC_Balance.Component.StandardScore *-2.38729 + 50.0456),colour = 'blue',size = 1.5) +     ggtitle("Effect of Balance Component on Total SRS Score(Males)") + ylab("Fitted Values") + xlab("mABC Balance Score") 
```

```{r}
females <- which(kki.adhd1$Gender == "F")
ggplot(data = kki.adhd[males,],aes(x = mABC_Balance.Component.StandardScore,y = fitted(lm.adhd)[males], colour = ADHD_Subtype)) + geom_point() + geom_jitter() +
  geom_line(data = kki.adhd1[males,],aes(x = mABC_Balance.Component.StandardScore, mABC_Balance.Component.StandardScore *-2.38729 + 64.0176),colour = 'red',size = 1.5) + 
  geom_line(data = kki.adhd1[males,],aes(x = mABC_Balance.Component.StandardScore, mABC_Balance.Component.StandardScore *-2.38729 + 50.0456),colour = 'blue',size = 1.5) +     ggtitle("Effect of Balance Component on Total SRS Score(Females)") + ylab("Fitted Values") + xlab("mABC Balance Score") 
```


```{r}
ggplot(data = NULL,aes(x = fitted(lm.adhd), y = residuals(lm.adhd))) + geom_point() + geom_hline( yintercept = 0) + geom_smooth() +
  ggtitle("Residual Plot for ADHD Model(1)") + xlab("Fitted Values") + ylab("Residual Values")
```



```{r,include= FALSE}
studentize <- function(model) {
  n = length(fitted(model))
  p = length(model$coefficients)
  s = (1/(n-p-1)) * sum(residuals(model)^2)
  residuals(model)/ (s * (sqrt(1-influence(model)$hat)))
}
student.lmadhd <- studentize(lm.adhd)
leverage.lmadhd <- influence(lm.adhd)$hat
```

```{r,include=FALSE}
ggplot(data = NULL,aes(x = leverage.lmadhd, y = student.lmadhd)) + geom_point() + geom_hline(y = 0)
```



$$
H_0: \text{Just Balance and Catching is Sufficient} \\
H_1: \text{Full Model is Sufficient} \\
\text{Under the null we got an F-statistic of 4.2735 where} \ F \sim F_{5,85} \\
\text{which gives us a p-value of .0016 with an} \ \alpha = .05 \ \text{we reject the null} \\
\text{and believe that we should keep every coefficient in the full model}
$$



## Results: ASD

```{r}
aut <- subset(kki, kki$PrimaryDiagnosis == "Autism")
lm.aut <- lm(Standard ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore + EdinburghHandedness_Integer + GAI + ADHD_Subtype + Gender + mABC_AGE, data = aut)
lm.aut.basic <- lm(SRS_TotalRawScore ~ mABC_AimingAndCatching.Component.StandardScore + mABC_Balance.Component.StandardScore, data = aut)
summary(lm.aut)
```

$$
\boldsymbol{\beta} = \begin{bmatrix}
            \text{Intercept} \\
            \text{Balance Score} \\
            \text{Aiming And Catching Score} \\
            \text{EdinburgHandedness_Integer} \\
            \text{GAI} \\
            \text{ADHD Subtype Inattentive} \\
            \text{Gender Male} \\
            \text{mABC_AGE} 
\end{bmatrix}
=
\begin{bmatrix}
54.25094 \\
0.37661 \\
-0.02558  \\
4.40532  \\
0.14978   \\
11.15424 \\
-6.57359 \\
 1.22425 
\end{bmatrix}
$$


```{r}
ggplot(data = NULL,aes(x = fitted(lm.aut), y = residuals(lm.aut))) + geom_point() + geom_hline( yintercept = 0) +
  ggtitle("Residual Plot for Autism Model") + xlab("Fitted Values") + ylab("Residual Values")
```

```{r}
qqnorm(lm.aut$residuals)
qqline(lm.aut$residuals, col = 'red')
```

```{r}
student.lmaut <- studentize(lm.aut)

leverage.lmaut <- influence(lm.aut)$hat
ggplot(data = NULL,aes(x = leverage.lmaut, y = student.lmaut)) + geom_point() + geom_hline( yintercept = 0)
leverage.lmaut <- influence(lm.aut)$hat
ggplot(data = NULL, aes(x = leverage.lmaut, y = student.lmaut)) + geom_point() + geom_hline(yintercept = 0)
```
